<html>
  <script src="game.js"></script>
  <script>
    window.addEventListener('message', (event) => {
      switch (event.data.type) {
      case 'initialState':
        console.debug("game generating initial state",event.data.players, event.data.setup);
        const initialState = game.initialState(event.data.players, event.data.setup);
        window.top.postMessage({type: "initialState", data: initialState}, "*")
        break;
      case 'processMove':
        console.debug("game proccessing move", event.data.move);
        try {
          const data = game.processMove(event.data.previousState, event.data.position, event.data.move);
          window.top.postMessage({type: "moveProcessed", id: event.data.move.id, error: undefined, data}, "*")
        } catch (e) {
          window.top.postMessage({type: "moveProcessed", id: event.data.move.id, error: String(e)}, "*")
        }
        break;
      }
    });
  </script>
</html>
