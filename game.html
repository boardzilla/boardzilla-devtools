<html>
  <script src="game.js"></script>
  <script>
    window.addEventListener('message', (event) => {
      console.log("Message received from the parent!: game ... ", event.data); // Message received from child
      switch (event.data.type) {
      case 'initialState':
        const initialState = game.initialState(event.data.players, event.data.setup);
        window.top.postMessage({type: "initialState", data: initialState}, "*")
        break;
      case 'processMove':
        try {
          const p = game.processMove(event.data.previousState, event.data.position, event.data.move);
          window.top.postMessage({type: "processMove", data: p}, "*")
        } catch (e) {
          window.top.postMessage({type: "processMoveError", position: event.data.position, move: event.data.move, error: String(e)}, "*")
        }
        break;
      }
    });
  </script>
</html>
